<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<title>Danger from the Deep</title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<link rel="Stylesheet" href="dftd.css" type="text/css" />
	<link rel="shortcut icon" href="./icons/favicon.ico" type="image/x-icon" />
	<link rel="icon" href="./icons/favicon.ico" type="image/x-icon" />
</head>
<body>
	<div class="container">
	<div class="head">
		<img src="images/header.jpg" alt="Danger from the Deep submarine simulator" />
	</div>
	<div class="menu">
		<ul class="menu">
			<li class="about"><a href="index.html">About</a></li>
			<li class="warn"><a href="warning.html">Warning</a></li>
			<li class="feat"><a href="features.html">Features</a></li>
			<li class="news"><a href="news.html">News</a></li>
			<li class="gallery"><a href="gallery.html">Gallery</a></li>
			<li class="download"><a href="download.html">Download</a></li>
			<li class="help"><a href="help_out.html">Help out</a></li>
			<li class="docu"><a href="documentation.html">Documentation</a></li>
			<li class="links"><a href="links.html">Links</a></li>
		</ul>
		<a href="http://validator.w3.org/check?uri=referer"><img class="std" src="images/xhtml.png" alt="XHTML Valid!" /></a>
		<br />
		<a href="http://jigsaw.w3.org/css-validator/check/referer"><img class="std" src="images/w3c-valid-css.png" alt="Valid CSS!" /></a>
	</div>
	<div class="contents">
   <h2 class="likechapterHead"><a 
 id="x1-1000"></a>Contents</h2> <div class="tableofcontents">
   <span class="chapterToc">1 <a 
href="#x1-20001" id="QQ2-1-2">A guide to the sourcecode of Danger from the Deep</a></span>
<br />   &#x00A0;<span class="sectionToc">1.1 <a 
href="#x1-30001.1" id="QQ2-1-3">General idea</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.1.1 <a 
href="#x1-40001.1.1" id="QQ2-1-4">Used libraries</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.1.2 <a 
href="#x1-50001.1.2" id="QQ2-1-5">Language: C++</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.1.3 <a 
href="#x1-60001.1.3" id="QQ2-1-6">Error handling</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.1.4 <a 
href="#x1-70001.1.4" id="QQ2-1-7">Basic classes and types</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.1.5 <a 
href="#x1-160001.1.5" id="QQ2-1-16">The game: state and display, the classes <span 
class="cmtt-10">game </span>and <span 
class="cmtt-10">user</span><span 
class="cmtt-10">_interface</span></a></span>
<br />   &#x00A0;<span class="sectionToc">1.2 <a 
href="#x1-170001.2" id="QQ2-1-17">Coding style</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.2.1 <a 
href="#x1-180001.2.1" id="QQ2-1-18">Introduction</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.2.2 <a 
href="#x1-190001.2.2" id="QQ2-1-19">Indentation</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.2.3 <a 
href="#x1-200001.2.3" id="QQ2-1-20">Placing (curly) braces</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.2.4 <a 
href="#x1-210001.2.4" id="QQ2-1-21">Naming</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.2.5 <a 
href="#x1-220001.2.5" id="QQ2-1-22">Closing words</a></span>
<br />   &#x00A0;<span class="sectionToc">1.3 <a 
href="#x1-230001.3" id="QQ2-1-23">What needs to be done</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsectionToc">1.3.1 <a 
href="#x1-240001.3.1" id="QQ2-1-24">Janitors wanted</a></span>
   </div>

   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;1</span><br /><a 
 id="x1-20001"></a>A guide to the sourcecode of Danger from the Deep</h2>
<!--l. 8--><p class="noindent">A short overview about the topics: </p>
     <ul class="itemize1">
     <li class="itemize">General idea
     </li>
     <li class="itemize">Coding style
     </li>
     <li class="itemize">What needs to be done</li></ul>
   <h3 class="sectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001.1"></a>General idea</h3>
<!--l. 18--><p class="noindent">The game arised from a graphic test for OpenGL under Linux. I wanted to try
out OpenGL graphics under Linux and &#xFB01;nally wrote some tile based water
rendering code. Later i added a simple model loader and had the very basics
of a submarine simulation. As i am a great fan of Silent Service and Aces
of the Deep (guess where the name comes from) and considered the fact
that there is or was no submarine simulation for Linux, i began to create
one.
</p><!--l. 27--><p class="indent">   The project started in January 2003 and the code evolved since that time. I
improved my knowledge about C++, OpenGL and about software development
in general. Other developers joined the project and added more ideas and
development ideas and styles. Often things were just tried out and thrown away
later. This all lead to code that seems a bit chaotic, more like evolution and
less planned. There are many places where this can be seen. Interfaces that
are not fully implemented, or various ways doing similar things around the
code.
</p><!--l. 39--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1.1   </span> <a 
 id="x1-40001.1.1"></a>Used libraries</h4>
<!--l. 41--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1.2   </span> <a 
 id="x1-50001.1.2"></a>Language: C++</h4>
<!--l. 43--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1.3   </span> <a 
 id="x1-60001.1.3"></a>Error handling</h4>
<!--l. 45--><p class="noindent">Currently the code treats errors as fatal events, reports it via message to command
line and quits the game. Checks are done using the <span 
class="cmbx-10">system::myassert()</span>

function, but this is embarassing and ugly. This mixes code test related
assertions with error checks. C++ exceptions are the de&#xFB01;nite thing to use
here, but are used very rarely yet. I discovered only recently how useful they
are.
</p><!--l. 54--><p class="indent">   The whole code (that means each place with a <span 
class="cmbx-10">system::myassert() call </span>has to
be checked wether it is an error check (in that case replaced by an descriptive
exception) or a development check (in that case a normal <span 
class="cmbx-10">assert() </span>could be used).
For exceptions one should de&#xFB01;ne classes that heir from <span 
class="cmbx-10">std::exception </span>and
contain an error string. A hierarchy of exceptions could be created for a &#xFB01;ner
grained error handling and control. Look at &#xFB01;le <span 
class="cmbx-10">error.h </span>for an example
de&#xFB01;nition.
</p><!--l. 64--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1.4   </span> <a 
 id="x1-70001.1.4"></a>Basic classes and types</h4>
<!--l. 66--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-80001.1.4"></a>Mathematical helper classes</h5>
<!--l. 68--><p class="noindent">There are some basic classes that implement various mathematical constructs as
template classes, so one can instantiate them for any needed data type.
Prede&#xFB01;ned names for <span 
class="cmtt-10">int</span>, <span 
class="cmtt-10">float </span>and <span 
class="cmtt-10">double </span>exist. These base classes are for
vectors (<span 
class="cmtt-10">vector2</span>, <span 
class="cmtt-10">vector3 </span>and <span 
class="cmtt-10">vector4</span>), matrices (<span 
class="cmtt-10">matrix4</span>) and quaternions
(<span 
class="cmtt-10">quaternion</span>). Operator overloading is used so that one can write equations and
formulas in a common style. The code is rather self explanatory, so have a
look.
</p><!--l. 78--><p class="indent">   There is also a helper class for (nautical) angles: <span 
class="cmtt-10">angle</span>, that implements
wrapping of values at 360 degrees and some other useful things.
</p><!--l. 82--><p class="indent">   And &#xFB01;nally a helper class for &#xFB01;xed point arithmetic data types: <span 
class="cmtt-10">fixed</span>. Fixed
point arithmetic is still faster for some cases and the precision is still high enough for
some tasks related to 3D rendering (do not use them for physics though, nor <span 
class="cmtt-10">float</span>,
but <span 
class="cmtt-10">double </span>for physics).
</p><!--l. 88--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-90001.1.4"></a>Other helper classes</h5>
<!--l. 90--><p class="noindent">bspline color data error &#xFB01;lehelper &#xFB01;xed objcache ptrset
</p><!--l. 92--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-100001.1.4"></a>Rendering and system related related classes</h5>

<!--l. 94--><p class="noindent">model.h sound.h texture.h font.h network.h color.h image.h system.h
</p><!--l. 103--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-110001.1.4"></a>Components of the game state and simulation</h5>
<!--l. 105--><p class="noindent">ai.h airplane.h game.h torpedo.h submarine.h gun&#x02D9;shell.h convoy.h sea&#x02D9;object.h
sensors.h ship.h depth&#x02D9;charge.h
</p><!--l. 117--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-120001.1.4"></a>Components of the graphical user interface</h5>
<!--l. 119--><p class="noindent">sub&#x02D9;bridge&#x02D9;display.h airplane&#x02D9;interface.h freeview&#x02D9;display.h sub&#x02D9;control&#x02D9;popup.h
sub&#x02D9;damage&#x02D9;display.h sub&#x02D9;gauges&#x02D9;display.h submarine&#x02D9;interface.h user&#x02D9;display.h
sub&#x02D9;periscope&#x02D9;display.h user&#x02D9;interface.h sub&#x02D9;tdc&#x02D9;display.h user&#x02D9;popup.h sub&#x02D9;tdc&#x02D9;popup.h
logbook&#x02D9;display.h sub&#x02D9;torpedo&#x02D9;display.h logbook.h sub&#x02D9;torpsetup&#x02D9;display.h
ship&#x02D9;interface.h sub&#x02D9;uzo&#x02D9;display.h map&#x02D9;display.h ships&#x02D9;sunk&#x02D9;display.h
</p><!--l. 141--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-130001.1.4"></a>Special 3D rendering related classes</h5>
<!--l. 143--><p class="noindent">ocean&#x02D9;wave&#x02D9;generator.h particle.h triangulate.h perlinnoise.h coastmap.h sky.h
water.h water&#x02D9;sse.h make&#x02D9;mesh.h
</p><!--l. 153--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-140001.1.4"></a>OpenGL GUI classes</h5>
<!--l. 155--><p class="noindent">widget.h
</p><!--l. 157--><p class="noindent">
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-150001.1.4"></a>Miscellaneous classes</h5>
<!--l. 159--><p class="noindent">tokencodes.h token.h tokenizer.h binstream.h gldebug.h parser.h global&#x02D9;data.h cfg.h
highscorelist.h keys.h texts.h credits.h
</p><!--l. 176--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.1.5   </span> <a 
 id="x1-160001.1.5"></a>The game: state and display, the classes <span 
class="cmtt-10">game </span>and <span 
class="cmtt-10">user</span><span 
class="cmtt-10">_interface</span></h4>

<!--l. 179--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-170001.2"></a>Coding style</h3>
<!--l. 181--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2.1   </span> <a 
 id="x1-180001.2.1"></a>Introduction</h4>
<!--l. 183--><p class="noindent">Well, this topic can cause much discussion and problems. Using only one style
throughout the whole code will enhance readability, but creating working code is
much more important than keeping style consistent at any cost. If you create new
code and have the choice, you should at least consider using the game&#8217;s style to
enhance readability. I won&#8217;t force you to this style, and many people (including
myself) are very sensitive to the topic of coding style (and maybe believe their
view is the right one), so this topic can lead to unproductive &#xFB02;ame wars. Be
warned.
</p><!--l. 194--><p class="indent">   Anyway, here i describe the style I use for the code of Danger from the Deep.
Code that was contributed by other people may have a different style, this is
already the case in current code. Most of my preferred style is the same
as described in the Linux Kernel CodingStyle (originally written by Linus
Torvalds).
</p><!--l. 201--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2.2   </span> <a 
 id="x1-190001.2.2"></a>Indentation</h4>
<!--l. 203--><p class="noindent">People differ on how many spaces to indent. In my opinion everything less than four
is a pain. I use eight, because this will really help one to see <span 
class="cmbx-10">how </span>indentation works
(and even after sitting many hours in front of the monitor). The simple solution to
this problem is: use <span 
class="cmbx-10">TABs </span>for indentation. Everyone can set his favorite tab width in
his editor then. This style rule is the most important. It is easy to ful&#xFB01;ll
though.
</p><!--l. 212--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2.3   </span> <a 
 id="x1-200001.2.3"></a>Placing (curly) braces</h4>
<!--l. 214--><p class="noindent">Yes, the old C discussion. I place braces at the end of the line of the command. Want
an example? here it comes:
</p><!--l. 218--><p class="indent">   Conditional commands:

</p>
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
if&#x00A0;(x&#x00A0;==&#x00A0;3)&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_something();
&#x00A0;<br />}&#x00A0;else&#x00A0;if&#x00A0;(y&#x00A0;==&#x00A0;4)&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_other();
&#x00A0;<br />}&#x00A0;else&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_another();
&#x00A0;<br />}
&#x00A0;<br />
&#x00A0;<br />switch&#x00A0;(a)&#x00A0;{
&#x00A0;<br />case&#x00A0;3:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_abc();
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;break;
&#x00A0;<br />case&#x00A0;4:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_efg();
&#x00A0;<br />}
</div>
</td></tr></table>
<!--l. 236--><p class="nopar">
</p><!--l. 238--><p class="indent">   Various loops:

</p>
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
for&#x00A0;(unsigned&#x00A0;i&#x00A0;=&#x00A0;0;&#x00A0;i&#x00A0;&lt;&#x00A0;3;&#x00A0;++i)&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;b&#x00A0;+=&#x00A0;z;
&#x00A0;<br />}
&#x00A0;<br />
&#x00A0;<br />do&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_nothing();
&#x00A0;<br />}&#x00A0;while&#x00A0;(z&#x00A0;==&#x00A0;5);
&#x00A0;<br />
&#x00A0;<br />while&#x00A0;(true)&#x00A0;{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_something();
&#x00A0;<br />}
</div>
</td></tr></table>
<!--l. 252--><p class="nopar">
</p><!--l. 254--><p class="indent">   Functions and classes:

</p>
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
void&#x00A0;foo(int&#x00A0;i)
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;do_func_code();
&#x00A0;<br />}
&#x00A0;<br />
&#x00A0;<br />class&#x00A0;xyz&#x00A0;:&#x00A0;public&#x00A0;abc
&#x00A0;<br />{
&#x00A0;<br />&#x00A0;private:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;int&#x00A0;a;
&#x00A0;<br />&#x00A0;public:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;xyz();
&#x00A0;<br />};
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;
</div>
</td></tr></table>
<!--l. 269--><p class="nopar">
</p><!--l. 271--><p class="indent">   Why this style? Kernighan and Ritchie used it and when XEmacs is set to
this style it produces this kind of style and its auto-formatting works best
with it. Seriously, this style leads to code that wastes less space (especially
saves lines!) without losing readability. I&#8217;ve seen much code that places each
brace in its own line at the cost that the code is much longer. The longer
it gets, the less &#xFB01;ts on one screen and one needs to scroll, which makes it
more difficult to follow the execution path of the code and to understand
it.
</p><!--l. 282--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2.4   </span> <a 
 id="x1-210001.2.4"></a>Naming</h4>
<!--l. 284--><p class="noindent">I prefer using lowerspace characters and underscores. Why? humans are more trained
to read lowerspace characters and underscores are a better optical partition than
mixing lowerspace and upperspace characters. Example: read this fast and see what
is easier. Lowerspace <span 
class="cmbx-10">this</span><span 
class="cmbx-10">_variable</span><span 
class="cmbx-10">_has</span><span 
class="cmbx-10">_a</span><span 
class="cmbx-10">_very</span><span 
class="cmbx-10">_long</span><span 
class="cmbx-10">_name</span>. Upperspace
<span 
class="cmbx-10">thisVariableHasAVeryLongName</span>. Horrible. Looks crowded to me. Anyway i
won&#8217;t force my views on anybody, but if in doubt, use lowerspace letters and
underscores.
</p><!--l. 295--><p class="indent">   The same goes for classes, members and functions. All should be in lowerspace
form. Methods that return some data from a class should be named <span 
class="cmbx-10">get</span><span 
class="cmbx-10">_xyz() </span>when
<span 
class="cmbx-10">xyz </span>is the name of the member. This is no hard rule, but it should be followed for
consistency.

</p><!--l. 302--><p class="indent">   The most important thing, and the only rule i urge you to really follow is to <span 
class="cmbx-10">not</span>
<span 
class="cmbx-10">use hungarian notation </span>nor anything similar. This is a very weird thing
some big, greedy software company introduced and makes code <span 
class="cmbx-10">hard to</span>
<span 
class="cmbx-10">read</span>. The compiler will check the type of the variables anyway, and if you
state that you would need this kind of notation to show what your variables
are or do, you did something wrong before. If you can&#8217;t tell from the name
of a variable what it does, then this is the real problem. Adding the type
to the name doesn&#8217;t &#xFB01;x the real problem. Maybe you also have too many
variables so that you want to add the type to distinguish between them?
Another problem is the reason: don&#8217;t make functions or classes too long or too
complicated!
</p><!--l. 317--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.2.5   </span> <a 
 id="x1-220001.2.5"></a>Closing words</h4>
<!--l. 319--><p class="noindent">These rules are no strict &#8221;you must follow them&#8221; rules. I prefer working code is added
to the game rather than keeping the style conform. But it can help to read and
understand the code, so please at least consider them. And follow them if in
doubt...
</p><!--l. 325--><p class="noindent">
</p>
   <h3 class="sectionHead"><span class="titlemark">1.3   </span> <a 
 id="x1-230001.3"></a>What needs to be done</h3>
<!--l. 327--><p class="noindent">
</p>
   <h4 class="subsectionHead"><span class="titlemark">1.3.1   </span> <a 
 id="x1-240001.3.1"></a>Janitors wanted</h4>
	</div>
	<div class="foot">&copy; 2006-2007 Danger from the Deep</div>
	</div>
</body>
</html>
